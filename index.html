<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link href="https://fonts.googleapis.com/css?family=Roboto:400,500" rel="stylesheet">

    <title>FI Narrative</title>
    <style>
        body {
        font-family: Roboto, sans-serif;
        }
        .tag {
            font-weight: normal;
            color: #1A1A1A;
            background-color:#0D69F222;
            border-radius: 16px;
            border: 1px solid #0D69F2;
            padding: 4px 8px;
            margin: 4px;
            display: inline-block;
        }
        .tags .tag{
            background-color: white;
            border-color: #ccc;
            color: gray;
        }

        .results {
            color: gray;
        }
        .highlight{
            background-color: #0D69F222;
        }
        .container{
            max-width: 700px;
            margin: 10px auto 20px;
            text-align: center;
        }
        #textbox{
            max-width: 700px;
            height: 400px;
            position: relative;
            margin: 0 auto 0;
        }
        #text-input, #outputDiv {
            border: 0;
            display: block;
            position: absolute;
            text-align: left;
            font-family: monospace;
            width: 100%;
            height: 400px;
            padding: 16px;
            box-sizing: border-box;
            font-size: 16px;
            background-color: transparent;
        }
        #text-input{
            outline: 1px solid #0066FF;
            resize: none;
        }
        #outputDiv{
            color: transparent;
            z-index: -1;
        }
        .label {
            margin-bottom: 10px;
            color: #999;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>FI Narrative Demo</h1>

        <i>E.g. The subject made an <span class="highlight">unauthorized entry</span> riding an <span class="highlight">electric bike</span> and <span class="highlight">carrying a gun</span>.</i>
        <br>
        <br>

        <div id="textbox">
            <textarea id="text-input" rows="10" cols="30" placeholder="Type something here..."></textarea>
            <div class="output" id="outputDiv"></div>
        </div>
        <p class="label">DETECTED TAGS</p>
        <div id="detected-tags" class="results">...</div>
        <br>    
        <p class="label">PRE-TRAINED TAGS AVAILABLE</p>
        <div class="tags"><span class="tag">Crash</span><span class="tag">E-bike</span><span class="tag">E Bike HRMNY</span><span class="tag">Gun Possession</span><span class="tag">Trespassing</span></div>
    </div>

    <script>
        // Define a list of synonyms for each tag
        const tags = {
            'Crash': ['crash','crashed','crashing','collision','collided','colliding','wreck','wrecked','wrecking','smash','smashed','smashing','impact','impacted','impacting','pileup','piled up','piling up','fender bender','fender benders','hit','hitting','bumped','bumping','slam','slammed','slamming','bang','banged','banging','prang','pranged','pranging','mishap','mishaps','tangle','tangled','tangling','crush','crushed','crushing','shunt','shunted','shunting','crassh','crashedh','crashingh','collison','colided','collidng','creash','crasshing','chrash','crass','carsh','craash','crrash','crasj','crsh','crsssh','chrashed'],
            'E-bike': ['e-bike','electric bike','ebike','e bicycle','electric bicycle','pedal-assist bike','pedelec','electric scooter','motorized bike','motor-assisted bicycle','power bike','battery bike','electric two-wheeler','e-scooter','eletric bike','e-bicke','ebik','e-bick','electric bycicle','elctric bike','e-bicyle','electrik bike','e-bik'],
            'Gun Possession': ['gun possession','firearm possession','weapon possession','armed possession','illegal possession of a firearm','illegal gun possession','unlawful firearm possession','carrying a weapon','carrying a firearm','unlawful possession of a weapon','possession of a firearm','possession of a weapon','carrying a gun','firearm ownership','gun ownership','illegal carrying of a firearm','unregistered firearm possession','weapon carrying','firearm carry','possessing a gun','posessing a firearm','gun posession','firearm posession','weapon posession','gun possesion','possesion of a firearm','posessing a weapon','gun possesion charge','posess a gun'],
            'Trespassing': ['trespassing','trespass','trespasses','trespassed','trespasser','trespassers','trespassing','unlawful entry','unlawfully entering','illegally entering','illegal entry','intrude','intrudes','intruded','intruding','intrusion','encroach','encroaches','encroached','encroaching','encroachment','breaking and entering','entering unlawfully','unauthorized access','unauthorized entry','invade','invades','invaded','invading','invasion','illegal trespassing','criminal trespassing','illegal entry to property','illegal presence','entering without permission','violating property boundaries','unlawful trespass','illegal trespass','tresspassing','tresspass','trespasssing','trepassing','tresspassing','trespasin','tresspasin','trespasing','tresppassing','trespassers','tresspas','trespas'],
            'E Bike HRMNY': ['e bike hrmny','ebike hrmny','electric bike hrmny','e-bike harmony','electric bicycle hrmny','ebike harmony','e-bike hrmny','e bike harmony','electric bike harmony','e bicycle hrmny','electric bicycle harmony','ebike hrmony','e bike hrmony','e-bike hrmony','e-bike hrnmy','e bike hrmni','ebike hrmni','e-bike hrmni','electric bike hrmni','ebike hrnmy','e bike hrnmy','electric bike hrnmy','e bike harmny','electric bike harmny','e bike hrmoni']
        };

        function detectTags() {
            const inputText = document.getElementById('text-input').value.toLowerCase();
            const detectedTags = [];
            const outputDiv = document.getElementById("outputDiv");
            for (const [tag, synonyms] of Object.entries(tags)) {
                for (const synonym of synonyms) {
                    if (inputText.includes(synonym)) {
                        // Add the tag to the result if it matches
                        if (!detectedTags.includes(tag)) {
                            detectedTags.push(tag);
                        }
                        break;
                    }
                    
                }
            }

            const keywords = [];
            for (const [tag, synonyms] of Object.entries(tags)) {
                for (const synonym of synonyms) {
                    if (inputText.includes(synonym)) {
                        if (!keywords.includes(synonym)) {
                            keywords.push(synonym)
                        }
                    }
                }
            }

            // Display the detected tags
            const resultsDiv = document.getElementById('detected-tags');
            if (detectedTags.length > 0) {
                resultsDiv.innerHTML = detectedTags.map(tag => `<span class="tag">${tag.charAt(0).toUpperCase() + tag.slice(1)}</span>`).join('');
            } else {
                resultsDiv.innerHTML = '<span>No matching tags found.</span>';
            }

            const escapeHTML = (str) =>
                str.replace(/&/g, "&amp;").replace(/</g, "&lt;").replace(/>/g, "&gt;");

            const highlightKeywords = (text) => {
                const regex = new RegExp(`\\b(${keywords.join("|")})\\b`, "gi"); // Match whole words, case insensitive
                return text.replace(regex, (match) => `<span class="highlight">${match}</span>`);
            };
            const textWithLineBreaks = inputText.replace(/\n/g, '<br>');
            const highlightedText = highlightKeywords(textWithLineBreaks);
            outputDiv.innerHTML = highlightedText;
            console.log(keywords)
        }
        document.getElementById('text-input').addEventListener('input', detectTags);
    </script>
</body>
</html>
